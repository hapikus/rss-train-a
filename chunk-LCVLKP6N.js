import{c as ot,d as rt,e as at}from"./chunk-SFFVLJMP.js";import{$ as P,$a as W,Ib as Z,Jb as tt,Kb as et,Lb as it,Mb as nt,Rb as st,Sb as F,U as R,V as B,W as L,Za as H,_a as q,aa as j,ab as J,bb as K,cb as Q,da as A,fa as X,ha as G,nb as U,ob as Y}from"./chunk-FEVQ5YGC.js";import{Bb as D,Gb as O,Hb as z,Ia as S,Ib as l,Ja as v,Rb as T,Sb as b,Tb as w,Ub as h,Vb as g,Wb as m,Xb as d,Yb as f,ac as M,f as C,fc as u,hc as p,la as k,ob as s,pb as y,qa as E,qc as _,rc as N,wa as $,yc as V,zc as I}from"./chunk-26O7SS3C.js";var dt={carriages:[""],cities:[""],id:NaN},lt=(()=>{let r=class r{constructor(e){this.apiService=e,this.routes=D([]),this.mode="view",this.updatingRoute=dt,this.getRoutes()}getRoutes(){return C(this,null,function*(){let e=yield this.apiService.fetchRoutes(),i=yield this.apiService.fetchStations(),t=e.map(n=>({id:n.id,carriages:n.carriages,cities:i.filter(c=>n.path.includes(c.id)).map(c=>c.city)}));this.routes.set(t)})}deleteRoute(e){return C(this,null,function*(){let i=yield this.apiService.deleteRoute(e);if(i){let t=this.routes().filter(n=>n.id!==e);this.routes.set(t)}return i})}createRoute(e){return C(this,null,function*(){(yield this.apiService.createRoute(e))&&this.getRoutes()})}updateRoute(e){return C(this,null,function*(){(yield this.apiService.updateRoute(e))&&this.getRoutes()})}};r.\u0275fac=function(i){return new(i||r)(E(F))},r.\u0275prov=k({token:r,factory:r.\u0275fac,providedIn:"root"});let o=r;return o})();var ut=()=>({span:24,offset:0}),ft=()=>({span:20});function Ct(o,r){if(o&1&&f(0,"nz-option",5),o&2){let a=r.$implicit;l("nzLabel",a.city)("nzValue",a.city)}}function ht(o,r){if(o&1&&f(0,"nz-option",5),o&2){let a=r.$implicit;l("nzLabel",a)("nzValue",a)}}function gt(o,r){if(o&1){let a=M();m(0,"nz-form-item")(1,"nz-form-control",3)(2,"nz-select",4),u("ngModelChange",function(i){S(a);let t=p().$index,n=p();return v(n.addStation(t,i))}),h(3,ht,1,2,"nz-option",5,b),d(),m(5,"button",6),u("click",function(i){S(a);let t=p().$implicit,n=p();return v(n.removeCityField(t,i))}),f(6,"span",7),d()()()}if(o&2){let a=p(),e=a.$implicit,i=a.$index,t=p();s(),l("nzXs",24)("nzSm",20),s(),l("formControlName",e.controlInstance),z("id",e.id),s(),g(t.connectedStations[i]),s(2),l("disabled",i<3)}}function _t(o,r){if(o&1&&O(0,gt,7,5,"nz-form-item"),o&2){let a=r.$index;T(a>0?0:-1)}}function St(o,r){if(o&1&&f(0,"nz-option",5),o&2){let a=r.$implicit;l("nzLabel",a.code)("nzValue",a.name)}}function vt(o,r){if(o&1&&f(0,"nz-option",5),o&2){let a=r.$implicit;l("nzLabel",a.code)("nzValue",a.name)}}function zt(o,r){if(o&1){let a=M();m(0,"nz-form-item")(1,"nz-form-control",9)(2,"nz-select",10),u("ngModelChange",function(){S(a);let i=p().$index,t=p();return v(t.addCarriage(i))}),h(3,vt,1,2,"nz-option",5,b),d(),m(5,"button",6),u("click",function(i){S(a);let t=p().$implicit,n=p();return v(n.removeCarriageField(t,i))}),f(6,"span",7),d()()()}if(o&2){let a=p(),e=a.$implicit,i=a.$index,t=p();s(),l("nzXs",24)("nzSm",20),s(),l("formControlName",e.controlInstance),z("id",e.id),s(),g(t.carriages),s(2),l("disabled",i<3)}}function bt(o,r){if(o&1&&O(0,zt,7,5,"nz-form-item"),o&2){let a=r.$index;T(a>0?0:-1)}}var yt="The number of stations must be at least 3",Ft="The number of carriages must be at least 3",At=(()=>{let r=class r{constructor(e,i,t){this.apiService=e,this.routesService=i,this.fb=t,this.citiesSubform=this.fb.record({}),this.carriagesSubform=this.fb.record({}),this.listOfCitiesControl=[],this.listOfCarriagesControl=[],this.stations=[],this.carriages=[],this.connectedStations=[[]],this.stationsLengthMessage=yt,this.carriagesLengthMessage=Ft,this.isSaveButtonDisabled=!0,this.routesService.mode==="update"?(this.addCityField(this.routesService.updatingRoute.cities[0]),this.addCarriageField(this.routesService.updatingRoute.carriages[0])):(this.addCityField(),this.addCarriageField()),this.init()}init(){return C(this,null,function*(){let e=yield this.apiService.fetchStations(),i=yield this.apiService.fetchCarriages();if(this.stations=e,this.carriages=i,this.routesService.mode==="update"){for(let t=1;t<this.routesService.updatingRoute.cities.length;t+=1){let n=this.getConnectedStationsByCity(this.routesService.updatingRoute.cities[t-1]);this.connectedStations.push(n),this.addCityField(this.routesService.updatingRoute.cities[t])}this.addCityField();for(let t=1;t<this.routesService.updatingRoute.carriages.length;t+=1)this.addCarriageField(this.routesService.updatingRoute.carriages[t]);this.addCarriageField()}})}addCityField(e="",i){return C(this,null,function*(){i?.preventDefault();let t=this.listOfCitiesControl.length>0?this.listOfCitiesControl[this.listOfCitiesControl.length-1].id+1:0,n={id:t,controlInstance:`station${t}`},c=this.listOfCitiesControl.push(n);t>=3?(this.stationsLengthMessage="",Object.keys(this.carriagesSubform.value).filter(x=>this.carriagesSubform.value[x]!=="").length>=3&&(this.isSaveButtonDisabled=!1),this.citiesSubform.addControl(this.listOfCitiesControl[c-1].controlInstance,this.fb.control(e))):(this.isSaveButtonDisabled=!0,this.citiesSubform.addControl(this.listOfCitiesControl[c-1].controlInstance,this.fb.control(e,R.required)))})}addCarriageField(e="",i){return C(this,null,function*(){i?.preventDefault();let t=this.listOfCarriagesControl.length>0?this.listOfCarriagesControl[this.listOfCarriagesControl.length-1].id+1:0,n={id:t,controlInstance:`carriage${t}`},c=this.listOfCarriagesControl.push(n);t>=3?(Object.keys(this.citiesSubform.value).filter(x=>this.citiesSubform.value[x]!=="").length>=3&&(this.isSaveButtonDisabled=!1),this.carriagesLengthMessage="",this.carriagesSubform.addControl(this.listOfCarriagesControl[c-1].controlInstance,this.fb.control(e))):(this.isSaveButtonDisabled=!0,this.carriagesSubform.addControl(this.listOfCarriagesControl[c-1].controlInstance,this.fb.control(e,R.required)))})}removeCityField(e,i){if(i.preventDefault(),this.listOfCitiesControl.length>1){let t=this.listOfCitiesControl.indexOf(e);this.listOfCitiesControl.splice(t,1),this.citiesSubform.removeControl(e.controlInstance)}}removeCarriageField(e,i){if(i.preventDefault(),this.listOfCarriagesControl.length>1){let t=this.listOfCarriagesControl.indexOf(e);this.listOfCarriagesControl.splice(t,1),this.carriagesSubform.removeControl(e.controlInstance)}}submitForm(){if(this.citiesSubform.valid&&this.carriagesSubform.valid){let e=Object.keys(this.citiesSubform.value).filter(n=>this.citiesSubform.value[n]!=="").map(n=>this.citiesSubform.value[n]),i=this.stations.filter(n=>e.includes(n.city)).map(n=>n.id),t=Object.keys(this.carriagesSubform.value).filter(n=>this.carriagesSubform.value[n]!=="").map(n=>this.carriagesSubform.value[n]);this.routesService.mode==="create"&&this.routesService.createRoute({carriages:t,path:i}),this.routesService.mode==="update"&&this.routesService.updateRoute({carriages:t,path:i,id:this.routesService.updatingRoute.id}),this.routesService.mode="view"}else Object.values(this.citiesSubform.controls).forEach(e=>{e.invalid&&(e.markAsDirty(),e.updateValueAndValidity({onlySelf:!0}))}),Object.values(this.carriagesSubform.controls).forEach(e=>{e.invalid&&(e.markAsDirty(),e.updateValueAndValidity({onlySelf:!0}))})}getConnectedStationsByCity(e){let i=this.stations.find(n=>n.city===e);return!i||!i.connectedTo?[]:i.connectedTo.map(n=>this.stations.find(c=>c.id===n.id)?.city).filter(n=>n!==void 0)}addStation(e,i){if(this.listOfCitiesControl.length===e+1){let t=this.getConnectedStationsByCity(i);this.connectedStations.push(t),this.addCityField()}}addCarriage(e){this.listOfCarriagesControl.length===e+1&&this.addCarriageField()}};r.\u0275fac=function(i){return new(i||r)(y(F),y(lt),y(X))},r.\u0275cmp=$({type:r,selectors:[["app-stations-form"]],standalone:!0,features:[V],decls:34,vars:23,consts:[[1,"wrapper"],["nz-form","",3,"ngSubmit","formGroup"],[1,"label",3,"nzXs","nzSm"],["nzErrorTip","Input station or delete this field.","nzHasFeedback","",1,"control",3,"nzXs","nzSm"],["nzShowSearch","","nzAllowClear","","nzPlaceHolder","Select a station",1,"select",3,"ngModelChange","formControlName"],[3,"nzLabel","nzValue"],["nz-button","","nzType","default","nzShape","circle",1,"remove-button",3,"click","disabled"],["nz-icon","","nzType","minus-circle-o"],[1,"ant-form-item-explain-error"],["nzErrorTip","Input carriage or delete this field.","nzHasFeedback","",1,"control",3,"nzXs","nzSm"],["nzShowSearch","","nzAllowClear","","nzPlaceHolder","Select a carriage",1,"select",3,"ngModelChange","formControlName"],[1,"control",3,"nzXs","nzSm"],["nz-button","","nzType","primary",1,"button",3,"disabled"],["nz-icon","","nzType","save"]],template:function(i,t){i&1&&(m(0,"section",0)(1,"form",1),u("ngSubmit",function(){return t.submitForm()}),m(2,"nz-form-label",2),_(3," Stations "),d(),m(4,"nz-form-item")(5,"nz-form-control",3)(6,"nz-select",4),u("ngModelChange",function(c){return t.addStation(0,c)}),h(7,Ct,1,2,"nz-option",5,b),d(),m(9,"button",6),u("click",function(c){return t.removeCityField(t.listOfCitiesControl[0],c)}),f(10,"span",7),d()()(),h(11,_t,1,1,null,null,w),m(13,"p",8),_(14),d()(),m(15,"form",1),u("ngSubmit",function(){return t.submitForm()}),m(16,"nz-form-label",2),_(17," Carriages "),d(),m(18,"nz-form-item")(19,"nz-form-control",9)(20,"nz-select",10),u("ngModelChange",function(){return t.addCarriage(0)}),h(21,St,1,2,"nz-option",5,b),d(),m(23,"button",6),u("click",function(c){return t.removeCarriageField(t.listOfCarriagesControl[0],c)}),f(24,"span",7),d()()(),h(25,bt,1,1,null,null,w),m(27,"p",8),_(28),d(),m(29,"nz-form-item")(30,"nz-form-control",11)(31,"button",12),f(32,"span",13),_(33,"Save "),d()()()()()),i&2&&(s(),l("formGroup",t.citiesSubform),s(),l("nzXs",24)("nzSm",4),s(3),l("nzXs",24)("nzSm",20),s(),l("formControlName",t.listOfCitiesControl[0].controlInstance),z("id",t.listOfCitiesControl[0].id),s(),g(t.stations),s(2),l("disabled",!0),s(2),g(t.listOfCitiesControl),s(3),N(t.stationsLengthMessage),s(),l("formGroup",t.carriagesSubform),s(),l("nzXs",24)("nzSm",4),s(3),l("nzXs",24)("nzSm",20),s(),l("formControlName",t.listOfCarriagesControl[0].controlInstance),z("id",t.listOfCarriagesControl[0].id),s(),g(t.carriages),s(2),l("disabled",!0),s(2),g(t.listOfCarriagesControl),s(3),N(t.carriagesLengthMessage),s(2),l("nzXs",I(21,ut))("nzSm",I(22,ft)),s(),l("disabled",t.isSaveButtonDisabled))},dependencies:[nt,Y,U,tt,Z,it,et,G,P,B,L,j,A,st,Q,K,W,J,q,H,at,ot,rt],styles:[".dynamic-delete-button[_ngcontent-%COMP%]{cursor:pointer;position:relative;top:4px;font-size:24px;color:#999;transition:all .3s}.remove-button[_ngcontent-%COMP%]{border:none}.remove-button[_ngcontent-%COMP%]:hover{color:#777}.select[_ngcontent-%COMP%]{width:84%;margin-right:8px}[nz-form][_ngcontent-%COMP%]{width:264px}.button[_ngcontent-%COMP%]{width:100%}.item[_ngcontent-%COMP%]{flex-direction:column}.label[_ngcontent-%COMP%]{font-weight:500;max-width:32%}.wrapper[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:center;gap:2rem}@media (max-width: 572px){.wrapper[_ngcontent-%COMP%]{flex-direction:column;align-items:center}}.control[_ngcontent-%COMP%]{max-width:100%}"]});let o=r;return o})();export{dt as a,lt as b,At as c};
